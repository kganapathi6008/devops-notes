# Docker Volumes

## 1. Introduction to Docker Volumes
Docker volumes are the preferred way to persist data generated by and used by Docker containers. Unlike bind mounts, volumes are managed by Docker and offer a cleaner and safer way to handle data storage.

### Advantages of Docker Volumes:
- **Persistence**: Data stored in volumes survives container restarts and removals.
- **Portability**: Volumes can be easily backed up, migrated, and shared across multiple containers.
- **Isolation**: Docker handles volume management, ensuring security and data integrity.
- **Dynamic Storage**: Volumes use the host's storage (like EBS in AWS), dynamically allocating space as needed.

---

## 2. Creating and Using Volumes

### Create a Docker volume
```bash
docker volume create my_volume
```

### Verify the volume
```bash
docker volume ls
```

### Inspect the volume
```bash
docker volume inspect my_volume
```

---

## 3. Mounting Volumes to Containers

### Using `-v` option (bind mount)
You can mount a local directory to a container using the `-v` option:

```bash
# Syntax: docker run -v <host_path>:<container_path>
docker run -d -v /path/on/host:/usr/share/nginx/html -p 8080:80 nginx
```

Explanation:
- `/path/on/host`: Local directory on your host machine.
- `/usr/share/nginx/html`: Nginx's default document root.
- `-p 8080:80`: Maps port 8080 on the host to port 80 in the container.
- `-d`: Runs the container in detached mode.

Now, if you place an `index.html` file in `/path/on/host`, Nginx will serve it.

---

## 4. Nginx Home Page Example: Without and With Volumes

### Without Volumes (Changes are lost after container stops)

1. Run an Nginx container:
```bash
docker run -d --name nginx_no_volume -p 8080:80 nginx
```
2. Enter the container:
```bash
docker exec -it nginx_no_volume bash
```
3. Modify the Nginx homepage:
```bash
echo "<h1>Hello from Nginx inside container</h1>" > /usr/share/nginx/html/index.html
```
4. Access http://localhost:8080 â€” you'll see the custom page.
5. Stop and remove the container:
```bash
docker stop nginx_no_volume
```
6. Restart a new Nginx container â€” the changes are gone.

### With Volumes (Changes persist)

1. Create a volume:
```bash
docker volume create nginx_volume
```
2. Run Nginx using the volume:
```bash
docker run -d --name nginx_with_volume -v nginx_volume:/usr/share/nginx/html -p 8080:80 nginx
```
3. Find the volume path:
```bash
docker volume inspect nginx_volume
```
4. Access the volume on the host and add a new homepage:
```bash
sudo find /var/lib/docker/volumes -name nginx_volume
cd /var/lib/docker/volumes/nginx_volume/_data
echo "<h1>Hello from Docker Volume</h1>" > index.html
```
5. Refresh http://localhost:8080 â€” you'll see the new homepage.

6. The changes persist even after stopping the container:
```bash
docker stop nginx_with_volume
```

Restart the container, and the custom homepage remains:
```bash
docker start nginx_with_volume
```

---

## 5. Synchronizing Changes Between Host and Container

If you make changes inside a container using a volume, they reflect on the host too.

1. Enter the running container:
```bash
docker exec -it nginx_with_volume bash
```
2. Change the homepage:
```bash
echo "<h1>Updated from inside container</h1>" > /usr/share/nginx/html/index.html
```
3. Check the change on the host (from volume path):
```bash
cat /var/lib/docker/volumes/nginx_volume/_data/index.html
```
The updated content will be visible both in the container and on the host.

---

## 6. Volume Size and Storage

Docker volumes do **not** have a fixed size. They dynamically use space from the host's storage (like EBS on cloud platforms).

To check volume disk usage:
```bash
du -sh /var/lib/docker/volumes/nginx_volume/_data
```

If you're running Docker on cloud platforms like AWS, the total available space depends on the size of the host's EBS volume.

---

## 7. Removing Volumes

- Remove an unused volume:
```bash
docker volume rm my_volume
```
- Remove all unused volumes:
```bash
docker volume prune
```

**Important:** Removing a volume deletes all data stored in it. Be cautious!

---

This guide covers Docker volumes, from basic concepts to practical examples, including syncing data between containers and hosts. ðŸš€
